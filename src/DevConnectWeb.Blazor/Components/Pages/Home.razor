@page "/"
@inject IHttpClientFactory HttpClientFactory

<PageTitle>DevConnect</PageTitle>

<h1>DevConnect</h1>
<p>This Blazor front-end is configured to work with the DevConnect API.</p>

<p>
    <button @onclick="LoadApiSpec">Check Swagger endpoint</button>
</p>

@if (statusMessage is not null)
{
    <article>@statusMessage</article>
}

@code {
    private string? statusMessage;

    private async Task LoadApiSpec()
    {
        try
        {
            var client = HttpClientFactory.CreateClient("DevConnectApi");
            using var response = await client.GetAsync("swagger/v1/swagger.json");
            statusMessage = response.IsSuccessStatusCode
                ? "API is reachable and Swagger is enabled."
                : $"API call failed: {(int)response.StatusCode} {response.ReasonPhrase}";
        }
        catch (Exception ex)
        {
            statusMessage = $"Unable to reach API: {ex.Message}";
        }
    }
}
